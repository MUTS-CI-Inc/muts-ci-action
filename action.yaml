name: "MUTS-CI-Action"
description: "Runs the mutation testing framework on a target C++ project"
inputs:
  project-path:
    description: "Path to the project root"
    required: true
  pr-assignees-json: # New input defined here
    description: "JSON array of pull request assignee usernames (logins)"
    required: false # Set to false in case the action is used outside a PR context
runs:
  using: "composite"
  steps:
    # New Step: Get Assignee Details and Format Output
    - name: Get Assignee Details and Set Environment Variable
      uses: actions/github-script@v7
      id: format_authors
      with:
        # Use the default token. The 'contents' permission should be sufficient 
        # for reading public profile data.
        github-token: ${{ github.token }}
        script: |
          const assigneesJson = `${{ inputs.pr-assignees-json }}`;
          const assignees = JSON.parse(assigneesJson || '[]');
          
          let targetAuthors = [];
          
          for (const login of assignees) {
            // 1. Fetch user details from the GitHub API
            // This gives you the 'name' and public 'email' from the user's profile.
            const { data: user } = await github.rest.users.getByUsername({
              username: login
            });

            // 2. Determine the name and email
            // Fallback to a constructed name/email if profile fields are empty.
            const name = user.name || login;
            const email = user.email || `${login}@users.noreply.github.com`;
            
            // 3. Format the string for the environment variable
            targetAuthors.push(`${name} <${email}>`);
          }

          const envVarValue = `[${targetAuthors.join(', ')}]`;

          // 4. Export the environment variable for subsequent steps
          console.log(`Setting TARGET_AUTHORS to: ${envVarValue}`);
          core.exportVariable('TARGET_AUTHORS', envVarValue);

    # ... (The rest of your steps, like Run MUTS-CI, can now access the variable)
    - name: "Run MUTS-Git"
      uses: "docker://ekrogh18/muts-git:0.2.0"
    - name: Run MUTS-CI
      uses: "docker://ekrogh18/muts-ci:0.2.0_old_urindev"
      env:
        # The variable is now available as a regular environment variable
        TARGET_AUTHORS: ${{ env.TARGET_AUTHORS }} 
      continue-on-error: true